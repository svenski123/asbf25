// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.17;

import "forge-std/Vm.sol";
Vm constant vm = Vm(address(uint160(uint256(keccak256("hevm cheat code")))));

interface Ilevel {
    function completeLevel(address studentContract) external payable returns(uint8, uint256);
}

function deploy_bytecode(bytes memory payload) returns (address payable addr) {
    assembly { addr := create(0, add(payload, 0x20), mload(payload)) }
}

function get_ctf(uint level) returns (Ilevel) {
    if (level == 0) {
	vm.etch(address(CTF_LEVEL_0), CTF_LEVEL_0_BC);
	vm.store(address(CTF_LEVEL_0), bytes32(0), bytes32(uint(42)));
	return Ilevel(CTF_LEVEL_0);
    } else if (level == 1) {
	vm.etch(address(CTF_LEVEL_1), CTF_LEVEL_1_BC);
	return Ilevel(CTF_LEVEL_1);
    } else if (level == 2) {
	vm.etch(address(CTF_LEVEL_2), CTF_LEVEL_2_BC);
	return Ilevel(CTF_LEVEL_2);
    } else if (level == 3) {
	vm.etch(address(CTF_LEVEL_3), CTF_LEVEL_3_BC);
	return Ilevel(CTF_LEVEL_3);
    } else if (level == 4) {
	vm.etch(address(CTF_LEVEL_4), CTF_LEVEL_4_BC);
	return Ilevel(CTF_LEVEL_4);
    } else if (level == 5) {
	vm.etch(address(CTF_LEVEL_5), CTF_LEVEL_5_BC);
	return Ilevel(CTF_LEVEL_5);
    } else {
	return Ilevel(address(0));
    }
}

Ilevel constant CTF_LEVEL_0 = Ilevel(address(0x62f7b940CB28E3155dCe1D0f8b3354BacFf910D5));
Ilevel constant CTF_LEVEL_1 = Ilevel(address(0xD58F512442f494ae5d8683032b536Bee391157D9));
Ilevel constant CTF_LEVEL_2 = Ilevel(address(0x5221F14737A44CDAba8ae5444dbAe52e2f56A5c2));
Ilevel constant CTF_LEVEL_3 = Ilevel(address(0xfc8ce1d84474f2B89602416dd829E71a93a9B0De));
Ilevel constant CTF_LEVEL_4 = Ilevel(address(0xE640De6a778C5fD542aA1bB11c77EEdc138f4358));
Ilevel constant CTF_LEVEL_5 = Ilevel(address(0x471B5b45c1D8e949b310b514BD6dc89704b881CF));

bytes constant CTF_LEVEL_0_BC = hex"608060405234801561001057600080fd5b506004361061002b5760003560e01c806397bf4cfb14610030575b600080fd5b61004361003e366004610108565b610060565b6040805160ff909316835260208301919091520160405180910390f35b60008060005a90506000846001600160a01b0316634fb602516040518163ffffffff1660e01b8152600401602060405180830381865afa1580156100a8573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906100cc9190610138565b905060005a6100db908461015b565b60005490915060ff908116908316036100fb576002969095509350505050565b6001969095509350505050565b60006020828403121561011a57600080fd5b81356001600160a01b038116811461013157600080fd5b9392505050565b60006020828403121561014a57600080fd5b815160ff8116811461013157600080fd5b8181038181111561017c57634e487b7160e01b600052601160045260246000fd5b9291505056fea2646970667358221220d7b0dc08a3ba2cdb7632fbbccf07dbee75c76d78f58d10a70ebeab014ed3195b64736f6c63430008110033";

bytes constant CTF_LEVEL_1_BC = hex"6080604052600436106100295760003560e01c80632530c9051461002e57806397bf4cfb14610061575b600080fd5b34801561003a57600080fd5b5061004e610049366004610466565b61008d565b6040519081526020015b60405180910390f35b61007461006f36600461047f565b6100f1565b6040805160ff9093168352602083019190915201610058565b6000814244336040516020016100c893929190928352602083019190915260601b6bffffffffffffffffffffffff1916604082015260540190565b6040516020818303038152906040528051906020012060001c6100eb91906104af565b92915050565b6040805160a08101909152600090819083908290806060810180610118600160801b61008d565b815260200161012a600160801b61008d565b8152508152602001604051806040016040528061014a600160801b61008d565b815260200161015c600160801b61008d565b8152508152602001604051806040016040528061017c600160801b61008d565b815260200161018e600160801b61008d565b905290526040805160a081019091529091506000908060608101806101b6600160801b61008d565b81526020016101c8600160801b61008d565b815250815260200160405180604001604052806101e8600160801b61008d565b81526020016101fa600160801b61008d565b8152508152602001604051806040016040528061021a600160801b61008d565b815260200161022c600160801b61008d565b905290526040805160a08101909152815151845151929350600092829160608301918291610259916104fd565b8152855160209081015188518201519190920191610276916104fd565b815250815260200160405180604001604052808560016003811061029c5761029c6104d1565b602090810291909101515190880151516102b691906104fd565b81526020868101518101518882015182015191909201916102d6916104fd565b81525081526020016040518060400160405280856002600381106102fc576102fc6104d1565b60200201515160408801515161031291906104fd565b81526040808701516020908101519189015181015192019161033491906104fd565b90529052905060005a90506000856001600160a01b031663342a2d9a86866040518363ffffffff1660e01b815260040161036f929190610562565b60c060405180830381865afa15801561038c573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103b091906105e6565b905060005a6103bf908461068f565b8451518351519192501480156103de5750602080850151519083015151145b80156103f35750604080850151519083015151145b801561040a57508351602090810151835190910151145b801561042457506020808501518101518382015190910151145b801561043f5750604080850151602090810151918401510151145b156104555760039a909950975050505050505050565b60019a909950975050505050505050565b60006020828403121561047857600080fd5b5035919050565b60006020828403121561049157600080fd5b81356001600160a01b03811681146104a857600080fd5b9392505050565b6000826104cc57634e487b7160e01b600052601260045260246000fd5b500690565b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052601160045260246000fd5b808201808211156100eb576100eb6104e7565b806000805b600381101561055b57825185835b6002811015610542578251825260209283019290910190600101610523565b5050506040949094019360209290920191600101610515565b5050505050565b61018081016105718285610510565b6104a860c0830184610510565b6040516060810167ffffffffffffffff811182821017156105af57634e487b7160e01b600052604160045260246000fd5b60405290565b6040805190810167ffffffffffffffff811182821017156105af57634e487b7160e01b600052604160045260246000fd5b600060c082840312156105f857600080fd5b601f838184011261060857600080fd5b61061061057e565b8060c085018681111561062257600080fd5b855b8181101561068357878582011261063b5760008081fd5b6106436105b5565b80604083018a8111156106565760008081fd5b835b81811015610670578051845260209384019301610658565b5050855250602090930192604001610624565b50909695505050505050565b818103818111156100eb576100eb6104e756fea26469706673582212201ff8515ff95e7d0d50fc9a4fb3316d4d5252736e5c827a4a88fd45d5ee57b14e64736f6c63430008110033";

bytes constant CTF_LEVEL_2_BC = hex"608060405234801561001057600080fd5b50600436106100365760003560e01c80632530c9051461003b57806397bf4cfb14610061575b600080fd5b61004e61004936600461053b565b61008d565b6040519081526020015b60405180910390f35b61007461006f366004610554565b6100f1565b6040805160ff9093168352602083019190915201610058565b6000814244336040516020016100c893929190928352602083019190915260601b6bffffffffffffffffffffffff1916604082015260540190565b6040516020818303038152906040528051906020012060001c6100eb919061059a565b92915050565b600080600083905060006040518061014001604052806063815260200160048152602001600781526020016001815260200160088152602001600e815260200160018152602001605a8152602001600381526020016037815250905060005a60405163104da39760e11b81529091506001600160a01b0384169063209b472e9061017f9085906004016105ae565b610140604051808303816000875af115801561019f573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101c391906105e0565b5060005a6101d19083610683565b905060006040518061014001604052806101f36840000000000000000061008d565b81526020016102046204000061008d565b8152602001610216630200000061008d565b8152602001610225602061008d565b815260200161023a660400000000000061008d565b815260200161024f660200000000000061008d565b8152602001610261600160641b61008d565b81526020016102756580000000000061008d565b81526020016102896520000000000061008d565b815260200161029961040061008d565b905260405163104da39760e11b81529091506000906001600160a01b0387169063209b472e906102cd9085906004016105ae565b610140604051808303816000875af11580156102ed573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061031191906105e0565b9050600061031e83610391565b9050600360005b600a811015610380578381600a811061034057610340610696565b60200201518382600a811061035757610357610696565b60200201511461036a5760019150610380565b6005915080610378816106ac565b915050610325565b509a93995092975050505050505050565b61039961051c565b6103b08260006103ab6001600a610683565b6103b4565b5090565b81818082036103c4575050505050565b60008560026103d387876106c5565b6103dd91906106ec565b6103e7908761071a565b600a81106103f7576103f7610696565b602002015190505b8183136104ee575b808684600a811061041a5761041a610696565b60200201511015610437578261042f81610742565b935050610407565b8582600a811061044957610449610696565b6020020151811015610467578161045f8161075a565b925050610437565b8183136104e9578582600a811061048057610480610696565b60200201518684600a811061049757610497610696565b60200201518785600a81106104ae576104ae610696565b602002018885600a81106104c4576104c4610696565b602002019190915252826104d781610742565b93505081806104e59061075a565b9250505b6103ff565b81851215610501576105018686846103b4565b83831215610514576105148684866103b4565b505050505050565b604051806101400160405280600a906020820280368337509192915050565b60006020828403121561054d57600080fd5b5035919050565b60006020828403121561056657600080fd5b81356001600160a01b038116811461057d57600080fd5b9392505050565b634e487b7160e01b600052601260045260246000fd5b6000826105a9576105a9610584565b500690565b6101408101818360005b600a8110156105d75781518352602092830192909101906001016105b8565b50505092915050565b60006101408083850312156105f457600080fd5b83601f84011261060357600080fd5b60405181810181811067ffffffffffffffff8211171561063357634e487b7160e01b600052604160045260246000fd5b60405290830190808583111561064857600080fd5b845b8381101561066257805182526020918201910161064a565b509095945050505050565b634e487b7160e01b600052601160045260246000fd5b818103818111156100eb576100eb61066d565b634e487b7160e01b600052603260045260246000fd5b6000600182016106be576106be61066d565b5060010190565b81810360008312801583831316838312821617156106e5576106e561066d565b5092915050565b6000826106fb576106fb610584565b600160ff1b8214600019841416156107155761071561066d565b500590565b808201828112600083128015821682158216171561073a5761073a61066d565b505092915050565b60006001600160ff1b0182016106be576106be61066d565b6000600160ff1b820161076f5761076f61066d565b50600019019056fea26469706673582212203d7204d7ae3a0d0e99ae9bec7d2fee5d73dbc5955dfc8a501edbc81847b697b064736f6c63430008110033";

bytes constant CTF_LEVEL_3_BC = hex"608060405234801561001057600080fd5b506004361061002b5760003560e01c806397bf4cfb14610030575b600080fd5b61004361003e36600461029b565b610060565b6040805160ff909316835260208301919091520160405180910390f35b600080828161007061ffff610224565b905060008061007f6002610224565b119050600060d061009565ffffffffffff610224565b60405160f086901b7fffff00000000000000000000000000000000000000000000000000000000000016602082015284151560f81b6022820152911b7fffffffffffff0000000000000000000000000000000000000000000000000000811660238301529150600090602901604051602081830303815290604052905060005a905060008060008873ffffffffffffffffffffffffffffffffffffffff1663ce0b1238866040518263ffffffff1660e01b815260040161015591906102d8565b6060604051808303816000875af1158015610174573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101989190610344565b92509250925060005a6101ab90866103c2565b90508361ffff168961ffff161480156101c75750821515881515145b80156101f757507fffffffffffff0000000000000000000000000000000000000000000000000000878116908316145b1561021057600a9d909c509a5050505050505050505050565b60019d909c509a5050505050505050505050565b60008142443360405160200161027293929190928352602083019190915260601b7fffffffffffffffffffffffffffffffffffffffff00000000000000000000000016604082015260540190565b6040516020818303038152906040528051906020012060001c61029591906103fc565b92915050565b6000602082840312156102ad57600080fd5b813573ffffffffffffffffffffffffffffffffffffffff811681146102d157600080fd5b9392505050565b600060208083528351808285015260005b81811015610305578581018301518582016040015282016102e9565b5060006040828601015260407fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0601f8301168501019250505092915050565b60008060006060848603121561035957600080fd5b835161ffff8116811461036b57600080fd5b6020850151909350801515811461038157600080fd5b60408501519092507fffffffffffff0000000000000000000000000000000000000000000000000000811681146103b757600080fd5b809150509250925092565b81810381811115610295577f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600082610432577f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b50069056fea26469706673582212206931f4b0e020d01df1dd677b62e751ace316147c4bfaf5e5544e7cd8c2e5ca3364736f6c63430008110033";

bytes constant CTF_LEVEL_4_BC = hex"6080604052600436106100295760003560e01c80632530c9051461002e57806397bf4cfb14610061575b600080fd5b34801561003a57600080fd5b5061004e610049366004610239565b61008d565b6040519081526020015b60405180910390f35b61007461006f366004610252565b610104565b6040805160ff9093168352602083019190915201610058565b6000814244336040516020016100db93929190928352602083019190915260601b7fffffffffffffffffffffffffffffffffffffffff00000000000000000000000016604082015260540190565b6040516020818303038152906040528051906020012060001c6100fe919061028f565b92915050565b60008082816101327fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff61008d565b90507f80000000000000000000000000000000000000000000000000000000000000005b818111156101665760011c610156565b8060005a6040517fdb53653e0000000000000000000000000000000000000000000000000000000081526004810186905290915060009073ffffffffffffffffffffffffffffffffffffffff87169063db53653e90602401602060405180830381865afa1580156101db573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101ff91906102ca565b905060005a61020e90846102e3565b905083820361022857600c9a909950975050505050505050565b60019a909950975050505050505050565b60006020828403121561024b57600080fd5b5035919050565b60006020828403121561026457600080fd5b813573ffffffffffffffffffffffffffffffffffffffff8116811461028857600080fd5b9392505050565b6000826102c5577f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b500690565b6000602082840312156102dc57600080fd5b5051919050565b818103818111156100fe577f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fdfea26469706673582212204f81324490883c1ae4e398093220c028b89fc78769d8548b928b725073d3c28864736f6c63430008110033";

bytes constant CTF_LEVEL_5_BC = hex"6080604052600436106100295760003560e01c80634f0be09c1461002e57806397bf4cfb1461006b575b600080fd5b34801561003a57600080fd5b506100556004803603810190610050919061049d565b61009c565b60405161006291906104d9565b60405180910390f35b61008560048036038101906100809190610552565b6100de565b6040516100939291906105b4565b60405180910390f35b6000814244336040516020016100b493929190610646565b6040516020818303038152906040528051906020012060001c6100d791906106b2565b9050919050565b600080600083905060006101117f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff61009c565b9050600061013e7f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff61009c565b9050600061014c8383610444565b905060005a905060008573ffffffffffffffffffffffffffffffffffffffff16632c81ea3586866040518363ffffffff1660e01b81526004016101909291906106e3565b602060405180830381865afa1580156101ad573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101d19190610721565b905060005a836101e1919061077d565b905060008773ffffffffffffffffffffffffffffffffffffffff16632c81ea357f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff60646040518363ffffffff1660e01b8152600401610241929190610831565b602060405180830381865afa15801561025e573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102829190610721565b905060006102b17f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6064610444565b905060008973ffffffffffffffffffffffffffffffffffffffff16632c81ea357f80000000000000000000000000000000000000000000000000000000000000007fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9b6040518363ffffffff1660e01b81526004016103309291906108d0565b602060405180830381865afa15801561034d573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103719190610721565b905060006103bf7f80000000000000000000000000000000000000000000000000000000000000007fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9b610444565b905082841480156103cf57508082145b61040e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161040590610956565b60405180910390fd5b87860361042c57600d859c509c50505050505050505050505061043f565b6001859c509c5050505050505050505050505b915091565b60006001828418901d82841761045a9190610976565b905092915050565b600080fd5b6000819050919050565b61047a81610467565b811461048557600080fd5b50565b60008135905061049781610471565b92915050565b6000602082840312156104b3576104b2610462565b5b60006104c184828501610488565b91505092915050565b6104d381610467565b82525050565b60006020820190506104ee60008301846104ca565b92915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061051f826104f4565b9050919050565b61052f81610514565b811461053a57600080fd5b50565b60008135905061054c81610526565b92915050565b60006020828403121561056857610567610462565b5b60006105768482850161053d565b91505092915050565b600060ff82169050919050565b6105958161057f565b82525050565b6000819050919050565b6105ae8161059b565b82525050565b60006040820190506105c9600083018561058c565b6105d660208301846105a5565b9392505050565b6000819050919050565b6105f86105f38261059b565b6105dd565b82525050565b60008160601b9050919050565b6000610616826105fe565b9050919050565b60006106288261060b565b9050919050565b61064061063b82610514565b61061d565b82525050565b600061065282866105e7565b60208201915061066282856105e7565b602082019150610672828461062f565b601482019150819050949350505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b60006106bd82610467565b91506106c883610467565b9250826106d8576106d7610683565b5b828207905092915050565b60006040820190506106f860008301856104ca565b61070560208301846104ca565b9392505050565b60008151905061071b81610471565b92915050565b60006020828403121561073757610736610462565b5b60006107458482850161070c565b91505092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60006107888261059b565b91506107938361059b565b92508282039050818111156107ab576107aa61074e565b5b92915050565b6000819050919050565b6000819050919050565b60006107e06107db6107d6846107b1565b6107bb565b610467565b9050919050565b6107f0816107c5565b82525050565b6000819050919050565b600061081b610816610811846107f6565b6107bb565b610467565b9050919050565b61082b81610800565b82525050565b600060408201905061084660008301856107e7565b6108536020830184610822565b9392505050565b6000819050919050565b600061087f61087a6108758461085a565b6107bb565b610467565b9050919050565b61088f81610864565b82525050565b6000819050919050565b60006108ba6108b56108b084610895565b6107bb565b610467565b9050919050565b6108ca8161089f565b82525050565b60006040820190506108e56000830185610886565b6108f260208301846108c1565b9392505050565b600082825260208201905092915050565b7f446964206e6f7420706173732074657374732100000000000000000000000000600082015250565b60006109406013836108f9565b915061094b8261090a565b602082019050919050565b6000602082019050818103600083015261096f81610933565b9050919050565b600061098182610467565b915061098c83610467565b92508282039050818112600084121682821360008512151617156109b3576109b261074e565b5b9291505056fea2646970667358221220aa57269d93d8b2a05b3829d6bb6f816a2cfdcb0b05cc3edc7a0125d8dc8ff33064736f6c63430008110033";
